<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Meal - UOPO</title>
    <link rel="stylesheet" href="css/uopo-branding.css">
    <style>
        .scan-box {
            background: #FEF8F0; padding: 22px 8px 18px 8px; border-radius: 12px; border: 2px dashed #D4A574;
            text-align: center; margin-bottom: 15px; min-height:130px;
        }
        #photo-preview img {
            max-width: 92vw; width: 200px; border-radius: 15px; margin: 10px auto 14px auto; box-shadow: 0 4px 14px #e1d1b6; display: block;
        }
        #fallback-btn { margin-top: 9px; background: #9B8B7E; }
        @media (max-width:600px){ .scan-box{padding:12px 3vw;} }
    </style>
</head>
<body>
<nav>
    <div class="logo">üåæ UOPO</div>
    <div>
        <a href="dashboard.html">Dashboard</a>
        <a href="family-profiles.html">Family</a>
        <a href="diet-tracker.html">Diet Tracker</a>
        <a href="signin.html">Sign Out</a>
    </div>
</nav>
<div class="container">
    <div class="page-header">
        <h1>üì∑ Log Your Meal</h1>
        <p>Take a photo to scan and log your meal instantly</p>
    </div>
    <div class="card">
        <h2>Camera Scanner</h2>
        <div class="scan-box">
            <input type="file" id="take-photo" accept="image/*" capture="environment" style="display:none;" onchange="processPhoto(this)">
            <input type="file" id="upload-photo" accept="image/*" style="display:none;" onchange="processPhoto(this)">
            <button class="btn" id="openCameraBtn" onclick="document.getElementById('take-photo').click()" style="display:none;">Take Photo</button>
            <button class="btn" id="fallback-btn" onclick="document.getElementById('upload-photo').click()">Manual Upload</button>
            <div id="photo-preview"></div>
        </div>
    </div>
    <div class="card">
        <h2>Manual Entry</h2>
        <div class="form-group">
            <label for="food-name">Food Name</label>
            <input type="text" id="food-name" placeholder="e.g., Chole Bhature">
        </div>
        <div class="form-group">
            <label for="portion">Portion Size</label>
            <input type="text" id="portion" placeholder="e.g., 150g or 2 pcs">
        </div>
        <div class="form-group">
            <label for="meal-time">Meal Time</label>
            <select id="meal-time">
                <option value="">Select</option>
                <option value="breakfast">üåÖ Breakfast</option>
                <option value="lunch">‚òÄÔ∏è Lunch</option>
                <option value="dinner">üåô Dinner</option>
                <option value="snack">üçé Snack</option>
            </select>
        </div>
        <button class="btn" onclick="logManualMeal()">‚úì Log Meal</button>
    </div>
</div>
<script>
function triggerInstantCamera() {
    // Instantly fire camera when page loads (mobile devices, most browsers)
    let t = document.getElementById('take-photo');
    if ("ontouchstart" in window || navigator.maxTouchPoints) {
        setTimeout(()=>t.click(), 400);
    } else {
        document.getElementById('openCameraBtn').style.display = 'inline-block';
    }
}
function processPhoto(input) {
  const photoPreview = document.getElementById('photo-preview');
  photoPreview.innerHTML = '';
  if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
          photoPreview.innerHTML = `<img src="${e.target.result}" alt="Your photo">`;
          sessionStorage.setItem('mealPhoto', e.target.result);
          setTimeout(() => window.location.href = "scan-result.html", 1100); // Fast forward to scan result
      }
      reader.readAsDataURL(input.files[0]);
  }
}
function logManualMeal() {
    const name=document.getElementById('food-name').value, mealTime=document.getElementById('meal-time').value;
    if(!name||!mealTime) { alert('Please fill all fields'); return;}
    alert(`‚úì Meal logged: ${name}`);
    window.location.href = 'dashboard.html'; // Or detailed meal log
}
document.addEventListener("DOMContentLoaded", triggerInstantCamera);
</script>
</body>
</html>
